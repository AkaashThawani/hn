<app-heading class="sticky"></app-heading>
<mat-card appearance="outlined" class="page flex flex-col flex-nowrap items-stretch justify-start">

  <!--
    This is the key. We create a container that grows to fill the space.
    This container will hold EITHER the table OR the skeleton.
  -->
  <div class="table-container flex-grow">
    @if (!isLoading) {
      <!-- This is the REAL CONTENT, shown only when data is fully loaded -->
      <table mat-table [dataSource]="ds" class="w100" [trackBy]="tableTrackBy">
        <ng-container matColumnDef="story">
          <td mat-cell *matCellDef="let element">
            <div class="story">
              <div>
                <span class="story-title flex">
                  <div class="flex-basis-[85%]">
                    {{element.data?.title}}
                  </div>
                  <div class="story-info flex-basis-[15%]">
                    <div class="tr w100">{{element.data?.processedTime}}</div>
                  </div>
                </span>
                <div class="story-url cursor-pointer" target="_blank" (click)="open(element?.data.url)">
                  {{element.data.url}}
                </div>
                <div class="story-meta flex w-full items-center pt-2">
                  <!-- Columns for author, comments, score -->
                  <div class="w-2/5">
                    <button mat-flat-button routerLink="/user/{{element?.data?.by}}" class="text-left justify-start p-0">
                      {{element.data.by?.trim()}}
                    </button>
                  </div>
                  <div class="w-3/12 text-center">
                    @if (element.data.type!='job') {
                    <button mat-flat-button [disabled]="element?.data?.descendants==0" routerLink="/story/{{element.id}}"
                      class="bg-none">
                      {{element?.data?.descendants}} comments
                    </button>
                    }
                  </div>
                  <div class="flex-grow text-right pr-4">
                    <span>{{element?.data?.score}} points</span>
                  </div>
                </div>
              </div>
            </div>
          </td>
        </ng-container>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    } @else {
      <!-- This is the SKELETON LOADER, shown when isLoading is true -->
      <div class="skeleton-container">
        @for (item of [1,2,3,4,5,6,7,8,9,10]; track $index) {
        <div class="skeleton-row">
          <div class="skeleton skeleton-text w-5/6"></div>
          <div class="skeleton skeleton-text w-full mt-2"></div>
          <div class="flex mt-4">
            <div class="skeleton skeleton-text w-1/4"></div>
            <div class="skeleton skeleton-text w-1/4 ml-4"></div>
          </div>
        </div>
        }
      </div>
    }
  </div>

  <!--
    THE PAGINATOR IS NOW PERMANENT.
    It is outside the @if/@else block and will never be destroyed,
    so it will always remember which page you are on.
  -->
  <mat-paginator (page)="onPageChange($event)" [length]="allStoryIds.length" [pageSize]="10"
    showFirstLastButtons="true" aria-label="Select page">
  </mat-paginator>

</mat-card>