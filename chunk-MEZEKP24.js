import{b as H}from"./chunk-TR34YA2A.js";import{f as M,g as U,h as W,i as X,j as Y,k as Z,l as tt,m as et,n as it,o as nt}from"./chunk-C4YZDM2T.js";import{k as ot,p as at,q as rt}from"./chunk-73UF4I5P.js";import{$a as $,Da as y,Ea as v,Eb as q,Fa as R,Ha as E,Ia as V,Ic as lt,Ja as p,Ka as r,La as d,Ma as g,O as I,P as D,Qa as L,Ra as j,Ta as F,Va as w,Wa as C,_a as B,ab as z,ea as s,ia as h,ib as m,jb as Q,kb as f,lb as b,lc as J,ma as O,nb as A,nc as N,o as P,oc as G,qa as x,r as T,vc as K}from"./chunk-GQJMJW7S.js";var dt=()=>[1,2,3,4,5,6,7,8,9,10];function ct(i,l){if(i&1&&(r(0,"button",20),m(1),d()),i&2){let t=C().$implicit;p("routerLink",b("/story/",t.id))("disabled",(t==null||t.data==null?null:t.data.descendants)==0),s(),f(" ",t==null||t.data==null?null:t.data.descendants," comments ")}}function mt(i,l){if(i&1){let t=F();r(0,"td",9)(1,"div",10)(2,"div")(3,"span",11)(4,"div",12),m(5),d(),r(6,"div",13)(7,"div",14),m(8),d()()(),r(9,"div",15),w("click",function(){let e=I(t).$implicit,o=C(2);return D(o.open(e==null?null:e.data.url))}),m(10),d(),r(11,"div",16)(12,"div",17)(13,"button",18),m(14),d()(),r(15,"div",19),y(16,ct,2,4,"button",20),d(),r(17,"div",21)(18,"span"),m(19),d()()()()()()}if(i&2){let t=l.$implicit;s(5),f(" ",t.data==null?null:t.data.title," "),s(3),Q(t.data==null?null:t.data.processedTime),s(2),f(" ",t.data.url," "),s(3),p("routerLink",b("/user/",t==null||t.data==null?null:t.data.by)),s(),f(" ",t.data.by==null?null:t.data.by.trim()," "),s(2),v(t.data.type!="job"?16:-1),s(3),f("",t==null||t.data==null?null:t.data.score," points")}}function ut(i,l){i&1&&g(0,"tr",22)}function pt(i,l){if(i&1&&(r(0,"table",3),L(1,6),x(2,mt,20,8,"td",7),j(),x(3,ut,1,0,"tr",8),d()),i&2){let t=C();p("dataSource",t.ds)("trackBy",t.tableTrackBy),s(3),p("matRowDefColumns",t.displayedColumns)}}function ft(i,l){i&1&&(r(0,"div",23),g(1,"div",24)(2,"div",25),r(3,"div",26),g(4,"div",27)(5,"div",28),d()())}function gt(i,l){i&1&&(r(0,"div",4),E(1,ft,6,0,"div",23,R),d()),i&2&&(s(),V(A(0,dt)))}var Et=(()=>{let l=class l{constructor(n,e,o){this.apiService=n,this.activatedRoute=e,this.router=o,this.allStoryIds=[],this.storyCache=new Map,this.ds=new nt([]),this.displayedColumns=["story"],this.isLoading=!0,this.router.routeReuseStrategy.shouldReuseRoute=()=>!1}ngOnInit(){this.activatedRoute.params.subscribe(n=>{this.apiService.modeType(n.id).subscribe(e=>{this.allStoryIds=e,this.loadPage(0)})})}onPageChange(n){this.loadPage(n.pageIndex)}loadPage(n){this.isLoading=!0,this.ds.data=[];let e=10,o=n*e,a=this.allStoryIds.slice(o,o+e),c=this.allStoryIds.slice(o+e,o+2*e),k=[...a,...c].filter(u=>!this.storyCache.has(u));if(k.length===0){this.updateDataSourceFromCache(a);return}let st=k.map(u=>this.apiService.getStoryById(u).pipe(P(_=>({id:u,data:_}))));T(st).subscribe(u=>{u.forEach(_=>this.storyCache.set(_.id,_.data)),this.updateDataSourceFromCache(a)})}updateDataSourceFromCache(n){let e=n.map(o=>{let a=this.storyCache.get(o);return a&&!a.processedTime&&(a.processedTime=this.getTime(a)),{id:o,data:a}});this.ds.data=e,this.isLoading=!1}getTime(n){let e=new Date().getTime(),o=new Date(n.time*1e3).getTime(),a=e-o,c=Math.floor(a/6e4),S=Math.floor(c/60);return c<60?`${c} minutes ago`:`${S} hours ago`}open(n){n&&window.open(n,"_blank")}tableTrackBy(n,e){return e.id}};l.\u0275fac=function(e){return new(e||l)(h(lt),h(J),h(N))},l.\u0275cmp=O({type:l,selectors:[["app-multi-mode-view"]],viewQuery:function(e,o){if(e&1&&B(M,5),e&2){let a;$(a=z())&&(o.paginator=a.first)}},decls:6,vars:3,consts:[[1,"sticky"],["appearance","outlined",1,"page","flex","flex-col","flex-nowrap","items-stretch","justify-start"],[1,"table-container","flex-grow"],["mat-table","",1,"w100",3,"dataSource","trackBy"],[1,"skeleton-container"],["showFirstLastButtons","true","aria-label","Select page",3,"page","length","pageSize"],["matColumnDef","story"],["mat-cell","",4,"matCellDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-cell",""],[1,"story"],[1,"story-title","flex"],[1,"flex-basis-[85%]"],[1,"story-info","flex-basis-[15%]"],[1,"tr","w100"],["target","_blank",1,"story-url","cursor-pointer",3,"click"],[1,"story-meta","flex","w-full","items-center","pt-2"],[1,"w-2/5"],["mat-flat-button","",1,"text-left","justify-start","p-0",3,"routerLink"],[1,"w-3/12","text-center"],["mat-flat-button","",1,"bg-none",3,"disabled","routerLink"],[1,"flex-grow","text-right","pr-4"],["mat-row",""],[1,"skeleton-row"],[1,"skeleton","skeleton-text","w-5/6"],[1,"skeleton","skeleton-text","w-full","mt-2"],[1,"flex","mt-4"],[1,"skeleton","skeleton-text","w-1/4"],[1,"skeleton","skeleton-text","w-1/4","ml-4"]],template:function(e,o){e&1&&(g(0,"app-heading",0),r(1,"mat-card",1)(2,"div",2),y(3,pt,4,3,"table",3)(4,gt,3,1,"div",4),d(),r(5,"mat-paginator",5),w("page",function(c){return o.onPageChange(c)}),d()()),e&2&&(s(3),v(o.isLoading?4:3),s(2),p("length",o.allStoryIds.length)("pageSize",10))},dependencies:[q,K,G,rt,at,ot,it,W,Y,X,tt,Z,et,U,M,H],styles:[".cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}.disabled-text[_ngcontent-%COMP%]{color:#00000042}.bg-none[_ngcontent-%COMP%]{background:none!important}.mat-expansion-panel-spacing[_ngcontent-%COMP%]{margin:0!important}.justify-content-start[_ngcontent-%COMP%]{justify-content:flex-start!important}.mat-column-upvote[_ngcontent-%COMP%]{width:15%}.tr[_ngcontent-%COMP%]{text-align:right!important}.w100[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]     .mat-mdc-card{display:flex;flex-direction:column;flex-grow:1}[_nghost-%COMP%]     .mat-mdc-row{height:6rem;border-bottom:1px solid #e5e7eb}.skeleton-container[_ngcontent-%COMP%]{padding:0 1.5rem}.skeleton-row[_ngcontent-%COMP%]{height:6rem;display:flex;flex-direction:column;justify-content:center;border-bottom:1px solid #e5e7eb}.skeleton[_ngcontent-%COMP%]{background-color:#e5e7eb;border-radius:.25rem;animation:_ngcontent-%COMP%_pulse 2s cubic-bezier(.4,0,.6,1) infinite}.skeleton-text[_ngcontent-%COMP%]{height:.875rem}@keyframes _ngcontent-%COMP%_pulse{50%{opacity:.5}}"]});let i=l;return i})();export{Et as MultiModeViewComponent};
